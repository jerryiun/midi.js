{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 2d8c67bfd2469a63edf4","webpack:///./src/index.js","webpack:///./src/root.js","webpack:///./src/loader.js","webpack:///./src/utils/index.js","webpack:///./src/utils/audio-detect.js","webpack:///./src/utils/load-script.js","webpack:///./src/utils/request.js","webpack:///./src/gm.js","webpack:///./src/player.js","webpack:///./src/jasmid/index.js","webpack:///./src/jasmid/midifile.js","webpack:///./src/jasmid/_stream.js","webpack:///./src/jasmid/replayer.js","webpack:///./src/plugins/index.js","webpack:///./src/plugins/audiotag.js","webpack:///./src/plugins/webaudio.js","webpack:///./src/plugins/webmidi.js"],"names":["window","MIDI","root","Soundfont","DEBUG","USE_XHR","soundfontUrl","loadPlugin","opts","onsuccess","supports","hash","location","api","substr","webmidi","AudioContext","Audio","connect","audioFormat","targetFormat","__api","__audioFormat","loadResource","instruments","instrument","i","length","GM","byId","id","format","WebMIDI","audiotag","requestQueue","webaudio","context","onprogress","onerror","pending","waitForEnd","instrumentId","sendRequest","evt","progress","fileProgress","queueProgress","soundfontPath","url","event","responseText","script","document","createElement","language","type","text","body","appendChild","loadScript","add","verify","setDefaultPlugin","midi","key","canPlayThrough","src","audio","mime","split","setAttribute","addEventListener","removeChild","audioDetect","navigator","requestMIDIAccess","isNative","Function","prototype","toString","call","indexOf","n","plugins","plugin","name","webkitAudioContext","canPlayType","vorbis","mpeg","time","Date","getTime","interval","setInterval","now","maxExecution","clearInterval","_globalExists","path","join","parts","object","e","LoadScript","loaded","loading","config","that","urls","doc","getElementsByTagName","testElement","element","test","getNext","hasError","batchTest","addElement","push","onreadystatechange","readyState","onload","removeTest","ret","onLoad","istrue","strictOrder","error","setTimeout","ID","request","data","method","headers","responseType","withCredentials","xhr","XMLHttpRequest","open","setRequestHeader","overrideMimeType","upload","total","totalBytes","lengthComputable","rawBytes","parseInt","getResponseHeader","isFinite","status","res","target","responseXML","JSON","parse","response","err","send","map","clean","replace","toLowerCase","byName","byCategory","list","num","number","category","getInstrument","channelId","channel","channels","setInstrument","program","delay","getMono","mono","setMono","truthy","getOmni","omni","setOmni","getSolo","solo","setSolo","pitchBend","mute","keyToNote","noteToKey","A0","C8","number2key","octave","Player","player","currentTime","endTime","restart","playing","timeWarp","startDelay","BPM","start","resume","startAudio","pause","tmp","stopAudio","stop","addListener","onMidiEvent","removeListener","undefined","clearAnimation","animationFrameId","cancelAnimationFrame","setAnimation","callback","tOurTime","tTheirTime","frame","requestAnimationFrame","minutes","seconds","t1","t2","end","events","noteRegistrar","loadMidiFile","replayer","Replayer","currentData","getData","getLength","console","loadFile","file","atob","fetch","t","ff","mx","scc","String","fromCharCode","z","charCodeAt","getFileInstruments","programs","subtype","programNumber","gm","eventQueue","queuedTime","startTime","scheduleTracking","note","offset","message","velocity","shift","getContext","WebAudio","ctx","totalTime","__now","getNow","performance","fromCache","messages","foffset","obj","queueTime","setController","controllerType","value","programChange","noteNumber","MIDIOffset","source","noteOn","noteOff","o","pop","clearTimeout","disconnect","MidiFile","lastEventTypeByte","readChunk","stream","read","readInt32","readEvent","deltaTime","readVarInt","eventTypeByte","readInt8","subtypeByte","Error","readInt16","microsecondsPerBeat","hourByte","frameRate","hour","min","sec","subframe","numerator","denominator","Math","pow","metronome","thirtyseconds","scale","param1","eventType","amount","headerChunk","headerStream","formatType","trackCount","timeDivision","ticksPerBeat","header","tracks","trackChunk","trackStream","eof","str","position","result","signed","b","clone","midiFile","eventProcessor","bpm","trackStates","beatsPerMinute","bpmOverride","getNextEvent","ticksToNextEvent","nextEventTrack","nextEventIndex","nextEvent","midiEvent","temporal","processEvents","processNext","beatsToGenerate","secondsToGenerate","ticksToEvent","AudioTag","volume","bufferNid","audioBuffers","notesOn","notes","nid","playChannel","instrumentNoteId","log","play","stopChannel","len","cId","setVolume","chordOn","chord","idx","chordOff","stopAllNotes","base64ToArrayBuffer","base64","binaryString","bytes","Uint8Array","buffer","useStreamingBuffer","sources","effects","masterVolume","noteId","bufferId","createMediaElementSource","createBufferSource","chain","input","gain","destination","playbackRate","gainNode","createGain","max","linearRampToValueAtTime","sid","setEffects","tunajs","effect","setContext","createAudioContext","newCtx","Tuna","bufferPending","requestAudio","soundfont","index","loadAudio","isLoaded","synth","controls","autoplay","preload","decodeAudioData","output","cancel","errFunction","then","access","pluginOutputs","outputs"],"mappings":"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","file":"midi.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"MIDI\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"MIDI\"] = factory();\n\telse\n\t\troot[\"MIDI\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 2d8c67bfd2469a63edf4\n **/","import root from './root'\nimport './loader'\nimport './gm'\nimport './player'\nimport './plugins'\n\nwindow.MIDI = root\nexport default root\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","export default {}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/root.js\n **/","/*\n  ----------------------------------------------------------\n  root.Plugin : 0.3.4 : 2015-03-26\n  ----------------------------------------------------------\n  https://github.com/mudcube/root.js\n  ----------------------------------------------------------\n  Inspired by javax.sound.midi (albeit a super simple version):\n    http://docs.oracle.com/javase/6/docs/api/javax/sound/midi/package-summary.html\n  ----------------------------------------------------------\n  Technologies\n  ----------------------------------------------------------\n    Web MIDI API - no native support yet (jazzplugin)\n    Web Audio API - firefox 25+, chrome 10+, safari 6+, opera 15+\n    HTML5 Audio Tag - ie 9+, firefox 3.5+, chrome 4+, safari 4+, opera 9.5+, ios 4+, android 2.3+\n  ----------------------------------------------------------\n*/\n\nimport { audioDetect, loadScript, request } from './utils'\nimport root from './root'\n\nroot.Soundfont = {}\nroot.DEBUG = true\nroot.USE_XHR = true\nroot.soundfontUrl = './soundfont/'\n\n/*\n  root.loadPlugin({\n    onsuccess: function() { },\n    onprogress: function(state, percent) { },\n    targetFormat: 'mp3', // optionally can force to use MP3 (for instance on mobile networks)\n    instrument: 'acoustic_grand_piano', // or 1 (default)\n    instruments: [ 'acoustic_grand_piano', 'acoustic_guitar_nylon' ] // or multiple instruments\n  })\n*/\n\nroot.loadPlugin = function (opts) {\n  if (typeof opts === 'function') {\n    opts = {onsuccess: opts}\n  }\n\n  root.soundfontUrl = opts.soundfontUrl || root.soundfontUrl\n\n  // / Detect the best type of audio to use\n  audioDetect(function (supports) {\n    var hash = window.location.hash\n    var api = ''\n\n    // / use the most appropriate plugin if not specified\n    if (supports[opts.api]) {\n      api = opts.api\n    } else if (supports[hash.substr(1)]) {\n      api = hash.substr(1)\n    } else if (supports.webmidi) {\n      api = 'webmidi'\n    } else if (window.AudioContext) { // Chrome\n      api = 'webaudio'\n    } else if (window.Audio) { // Firefox\n      api = 'audiotag'\n    }\n\n    if (connect[api]) {\n      // / use audio/ogg when supported\n      let audioFormat\n      if (opts.targetFormat) {\n        audioFormat = opts.targetFormat\n      } else { // use best quality\n        audioFormat = supports['audio/ogg'] ? 'ogg' : 'mp3'\n      }\n\n      // / load the specified plugin\n      root.__api = api\n      root.__audioFormat = audioFormat\n      root.supports = supports\n      root.loadResource(opts)\n    }\n  })\n}\n\n/*\n  root.loadResource({\n    onsuccess: function() { },\n    onprogress: function(state, percent) { },\n    instrument: 'banjo'\n  })\n*/\n\nroot.loadResource = function (opts) {\n  var instruments = opts.instruments || opts.instrument || 'acoustic_grand_piano'\n  // /\n  if (typeof instruments !== 'object') {\n    if (instruments || instruments === 0) {\n      instruments = [instruments]\n    } else {\n      instruments = []\n    }\n  }\n  // / convert numeric ids into strings\n  for (var i = 0; i < instruments.length; i++) {\n    var instrument = instruments[i]\n    if (instrument === +instrument) { // is numeric\n      if (root.GM.byId[instrument]) {\n        instruments[i] = root.GM.byId[instrument].id\n      }\n    }\n  }\n  // /\n  opts.format = root.__audioFormat\n  opts.instruments = instruments\n  // /\n  connect[root.__api](opts)\n}\n\nvar connect = {\n  webmidi: function (opts) {\n    // cant wait for this to be standardized!\n    root.WebMIDI.connect(opts)\n  },\n  audiotag: function (opts) {\n    // works ok, kinda like a drunken tuna fish, across the board\n    // http://caniuse.com/audio\n    requestQueue(opts, 'AudioTag')\n  },\n  webaudio: function (opts) {\n    // works awesome! safari, chrome and firefox support\n    // http://caniuse.com/web-audio\n    requestQueue(opts, 'WebAudio')\n  }\n}\n\nvar requestQueue = function (opts, context) {\n  var audioFormat = opts.format\n  var instruments = opts.instruments\n  var onprogress = opts.onprogress\n  var onerror = opts.onerror\n  // /\n  var length = instruments.length\n  var pending = length\n  var waitForEnd = function () {\n    if (!--pending) {\n      onprogress && onprogress('load', 1.0)\n      root[context].connect(opts)\n    }\n  }\n  // /\n  for (var i = 0; i < length; i++) {\n    var instrumentId = instruments[i]\n    if (root.Soundfont[instrumentId]) { // already loaded\n      waitForEnd()\n    } else { // needs to be requested\n      sendRequest(instruments[i], audioFormat, function (evt, progress) {\n        var fileProgress = progress / length\n        var queueProgress = (length - pending) / length\n        onprogress && onprogress('load', fileProgress + queueProgress, instrumentId)\n      }, function () {\n        waitForEnd()\n      }, onerror)\n    }\n  }\n}\n\nvar sendRequest = function (instrumentId, audioFormat, onprogress, onsuccess, onerror) {\n  var soundfontPath = root.soundfontUrl + instrumentId + '-' + audioFormat + '.js'\n  if (root.USE_XHR) {\n    request({\n      url: soundfontPath,\n      format: 'text',\n      onerror: onerror,\n      onprogress: onprogress,\n      onsuccess: function (event, responseText) {\n        var script = document.createElement('script')\n        script.language = 'javascript'\n        script.type = 'text/javascript'\n        script.text = responseText\n        document.body.appendChild(script)\n        onsuccess()\n      }\n    })\n  } else {\n    loadScript.add({\n      url: soundfontPath,\n      verify: 'root.Soundfont[\"' + instrumentId + '\"]',\n      onerror: onerror,\n      onsuccess: function () {\n        onsuccess()\n      }\n    })\n  }\n}\n\nroot.setDefaultPlugin = function (midi) {\n  for (var key in midi) {\n    root[key] = midi[key]\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/loader.js\n **/","export * from './audio-detect'\nexport * from './load-script'\nexport * from './request'\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/index.js\n **/","/*\n  ----------------------------------------------------------\n  midi.audioDetect : 0.3.2 : 2015-03-26\n  ----------------------------------------------------------\n  https://github.com/mudcube/midi.js\n  ----------------------------------------------------------\n  Probably, Maybe, No... Absolutely!\n  Test to see what types of <audio> MIME types are playable by the browser.\n  ----------------------------------------------------------\n*/\n\nconst supports = {} // object of supported file types\nlet pending = 0 // pending file types to process\nconst canPlayThrough = function (src) { // check whether format plays through\n  pending++\n  const body = document.body\n  const audio = new window.Audio()\n  const mime = src.split(';')[0]\n  audio.id = 'audio'\n  audio.setAttribute('preload', 'auto')\n  audio.setAttribute('audiobuffer', true)\n  audio.addEventListener('error', function () {\n    body.removeChild(audio)\n    supports[mime] = false\n    pending--\n  }, false)\n  audio.addEventListener('canplaythrough', function () {\n    body.removeChild(audio)\n    supports[mime] = true\n    pending--\n  }, false)\n  audio.src = 'data:' + src\n  body.appendChild(audio)\n}\n\nexport const audioDetect = function (onsuccess) {\n  // / detect jazz-midi plugin\n  if (navigator.requestMIDIAccess) {\n    const isNative = Function.prototype.toString.call(navigator.requestMIDIAccess).indexOf('[native code]')\n    if (isNative) { // has native midiapi support\n      supports['webmidi'] = true\n    } else { // check for jazz plugin midiapi support\n      for (let n = 0; navigator.plugins.length > n; n++) {\n        const plugin = navigator.plugins[n]\n        if (plugin.name.indexOf('Jazz-Plugin') >= 0) {\n          supports['webmidi'] = true\n        }\n      }\n    }\n  }\n\n  // / check whether <audio> tag is supported\n  if (typeof (window.Audio) === 'undefined') {\n    return onsuccess({})\n  } else {\n    supports['audiotag'] = true\n  }\n\n  // / check for webaudio api support\n  if (window.AudioContext || window.webkitAudioContext) {\n    supports['webaudio'] = true\n  }\n\n  // / check whether canPlayType is supported\n  const audio = new window.Audio()\n  if (typeof (audio.canPlayType) === 'undefined') {\n    return onsuccess(supports)\n  }\n\n  // / see what we can learn from the browser\n  let vorbis = audio.canPlayType('audio/ogg; codecs=\"vorbis\"')\n  vorbis = (vorbis === 'probably' || vorbis === 'maybe')\n  let mpeg = audio.canPlayType('audio/mpeg')\n  mpeg = (mpeg === 'probably' || mpeg === 'maybe')\n  // maybe nothing is supported\n  if (!vorbis && !mpeg) {\n    onsuccess(supports)\n    return\n  }\n\n  // / or maybe something is supported\n  if (vorbis) canPlayThrough('audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA=')\n  if (mpeg) canPlayThrough('audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq')\n\n  // / lets find out!\n  const time = (new Date()).getTime()\n  let interval = window.setInterval(function () {\n    const now = (new Date()).getTime()\n    const maxExecution = now - time > 5000\n    if (!pending || maxExecution) {\n      window.clearInterval(interval)\n      onsuccess(supports)\n    }\n  }, 1)\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/audio-detect.js\n **/","/*\n  -----------------------------------------------------------\n  loadScript.js : 0.1.4 : 2014/02/12 : http://mudcu.be\n  -----------------------------------------------------------\n  Copyright 2011-2014 Mudcube. All rights reserved.\n  -----------------------------------------------------------\n  /// No verification\n  loadScript.add(\"../js/jszip/jszip.js\")\n  /// Strict loading order and verification.\n  loadScript.add({\n    strictOrder: true,\n    urls: [\n      {\n        url: \"../js/jszip/jszip.js\",\n        verify: \"JSZip\",\n        onsuccess: function() {\n          console.log(1)\n        }\n      },\n      {\n        url: \"../inc/downloadify/js/swfobject.js\",\n        verify: \"swfobject\",\n        onsuccess: function() {\n          console.log(2)\n        }\n      }\n    ],\n    onsuccess: function() {\n      console.log(3)\n    }\n  })\n  /// Just verification.\n  loadScript.add({\n    url: \"../js/jszip/jszip.js\",\n    verify: \"JSZip\",\n    onsuccess: function() {\n      console.log(1)\n    }\n  })\n*/\n\nconst _globalExists = function (path, root) {\n  try {\n    path = path.split('\"').join('').split(\"'\").join('').split(']').join('').split('[').join('.')\n    var parts = path.split('.')\n    var length = parts.length\n    var object = root || window\n    for (var n = 0; n < length; n++) {\n      var key = parts[n]\n      if (object[key] == null) {\n        return false\n      } else { //\n        object = object[key]\n      }\n    }\n    return true\n  } catch (e) {\n    return false\n  }\n}\n\nconst LoadScript = function () {\n  this.loaded = {}\n  this.loading = {}\n  return this\n}\n\nLoadScript.prototype.add = function (config) {\n  var that = this\n  if (typeof (config) === 'string') {\n    config = { url: config }\n  }\n  var urls = config.urls\n  if (typeof (urls) === 'undefined') {\n    urls = [{\n      url: config.url,\n      verify: config.verify\n    }]\n  }\n  // / adding the elements to the head\n  var doc = document.getElementsByTagName('head')[0]\n  // /\n  var testElement = function (element, test) {\n    if (that.loaded[element.url]) return\n    if (test && _globalExists(test) === false) return\n    that.loaded[element.url] = true\n    //\n    if (that.loading[element.url]) that.loading[element.url]()\n    delete that.loading[element.url]\n    //\n    if (element.onsuccess) element.onsuccess()\n    if (typeof (getNext) !== 'undefined') getNext()\n  }\n  // /\n  var hasError = false\n  var batchTest = []\n  var addElement = function (element) {\n    if (typeof (element) === 'string') {\n      element = {\n        url: element,\n        verify: config.verify\n      }\n    }\n    if (/([\\w\\d.\\[\\]'\"])$/.test(element.verify)) { // check whether its a variable reference\n      var verify = element.test = element.verify\n      if (typeof (verify) === 'object') {\n        for (var n = 0; n < verify.length; n++) {\n          batchTest.push(verify[n])\n        }\n      } else {\n        batchTest.push(verify)\n      }\n    }\n    if (that.loaded[element.url]) return\n    var script = document.createElement('script')\n    script.onreadystatechange = function () {\n      if (this.readyState !== 'loaded' && this.readyState !== 'complete') return\n      testElement(element)\n    }\n    script.onload = function () {\n      testElement(element)\n    }\n    script.onerror = function () {\n      hasError = true\n      delete that.loading[element.url]\n      if (typeof (element.test) === 'object') {\n        for (let key in element.test) {\n          removeTest(element.test[key])\n        }\n      } else {\n        removeTest(element.test)\n      }\n    }\n    script.setAttribute('type', 'text/javascript')\n    script.setAttribute('src', element.url)\n    doc.appendChild(script)\n    that.loading[element.url] = function () {}\n  }\n  // / checking to see whether everything loaded properly\n  var removeTest = function (test) {\n    var ret = []\n    for (var n = 0; n < batchTest.length; n++) {\n      if (batchTest[n] === test) continue\n      ret.push(batchTest[n])\n    }\n    batchTest = ret\n  }\n  var onLoad = function (element) {\n    if (element) {\n      testElement(element, element.test)\n    } else {\n      for (let n = 0; n < urls.length; n++) {\n        testElement(urls[n], urls[n].test)\n      }\n    }\n    var istrue = true\n    for (let n = 0; n < batchTest.length; n++) {\n      if (_globalExists(batchTest[n]) === false) {\n        istrue = false\n      }\n    }\n    if (!config.strictOrder && istrue) { // finished loading all the requested scripts\n      if (hasError) {\n        if (config.error) {\n          config.error()\n        }\n      } else if (config.onsuccess) {\n        config.onsuccess()\n      }\n    } else { // keep calling back the function\n      setTimeout(function () { // - should get slower over time?\n        onLoad(element)\n      }, 10)\n    }\n  }\n  // / loading methods;  strict ordering or loose ordering\n  if (config.strictOrder) {\n    var ID = -1\n    var getNext = function () {\n      ID++\n      if (!urls[ID]) { // all elements are loaded\n        if (hasError) {\n          if (config.error) {\n            config.error()\n          }\n        } else if (config.onsuccess) {\n          config.onsuccess()\n        }\n      } else { // loading new script\n        var element = urls[ID]\n        var url = element.url\n        if (that.loading[url]) { // already loading from another call (attach to event)\n          that.loading[url] = function () {\n            if (element.onsuccess) element.onsuccess()\n            getNext()\n          }\n        } else if (!that.loaded[url]) { // create script element\n          addElement(element)\n          onLoad(element)\n        } else { // it's already been successfully loaded\n          getNext()\n        }\n      }\n    }\n    getNext()\n  } else { // loose ordering\n    for (let ID = 0; ID < urls.length; ID++) {\n      addElement(urls[ID])\n      onLoad(urls[ID])\n    }\n  }\n}\n\nexport const loadScript = new LoadScript()\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/load-script.js\n **/","/*\n  ----------------------------------------------------------\n  Request : 0.1.1 : 2015-03-26\n  ----------------------------------------------------------\n  request({\n    url: './dir/something.extension',\n    data: 'test!',\n    format: 'text', // text | xml | json | binary\n    responseType: 'text', // arraybuffer | blob | document | json | text\n    headers: {},\n    withCredentials: true, // true | false\n    ///\n    onerror: function(evt, percent) {\n      console.log(evt)\n    },\n    onsuccess: function(evt, responseText) {\n      console.log(responseText)\n    },\n    onprogress: function(evt, percent) {\n      percent = Math.round(percent * 100)\n      loader.create('thread', 'loading... ', percent)\n    }\n  })\n*/\n\nexport function request (opts, onsuccess, onerror, onprogress) {\n  if (typeof opts === 'string') opts = {url: opts}\n  const data = opts.data\n  const url = opts.url\n  const method = opts.method || (opts.data ? 'POST' : 'GET')\n  const format = opts.format\n  const headers = opts.headers\n  const responseType = opts.responseType\n  const withCredentials = opts.withCredentials || false\n  const xhr = new window.XMLHttpRequest()\n  onsuccess = onsuccess || opts.onsuccess\n  onerror = onerror || opts.onerror\n  onprogress = onprogress || opts.onprogress\n  xhr.open(method, url, true)\n  if (headers) {\n    for (var type in headers) {\n      xhr.setRequestHeader(type, headers[type])\n    }\n  } else if (data) { // set the default headers for POST\n    xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded')\n  }\n  if (format === 'binary') { // - default to responseType=\"blob\" when supported\n    if (xhr.overrideMimeType) {\n      xhr.overrideMimeType('text/plain; charset=x-user-defined')\n    }\n  }\n  if (responseType) {\n    xhr.responseType = responseType\n  }\n  if (withCredentials) {\n    xhr.withCredentials = 'true'\n  }\n  if (onerror && 'onerror' in xhr) {\n    xhr.onerror = onerror\n  }\n  if (onprogress && xhr.upload && 'onprogress' in xhr.upload) {\n    if (data) {\n      xhr.upload.onprogress = function (evt) {\n        onprogress.call(xhr, evt, evt.loaded / evt.total)\n      }\n    } else {\n      xhr.addEventListener('progress', function (evt) {\n        var totalBytes = 0\n        if (evt.lengthComputable) {\n          totalBytes = evt.total\n        } else if (xhr.totalBytes) {\n          totalBytes = xhr.totalBytes\n        } else {\n          var rawBytes = parseInt(xhr.getResponseHeader('Content-Length-Raw'))\n          if (isFinite(rawBytes)) {\n            xhr.totalBytes = totalBytes = rawBytes\n          } else {\n            return\n          }\n        }\n        onprogress.call(xhr, evt, evt.loaded / totalBytes)\n      })\n    }\n  }\n  // /\n  xhr.onreadystatechange = function (evt) {\n    if (xhr.readyState === 4) { // The request is complete\n      if (xhr.status === 200 || // Response OK\n        xhr.status === 304 || // Not Modified\n        xhr.status === 308 // Permanent Redirect\n      ) {\n        if (onsuccess) {\n          var res\n          if (format === 'xml') {\n            res = evt.target.responseXML\n          } else if (format === 'text') {\n            res = evt.target ? evt.target.responseText : xhr.responseText\n          } else if (format === 'json') {\n            try {\n              res = JSON.parse(evt.target.response)\n            } catch (err) {\n              onerror && onerror.call(xhr, evt)\n            }\n          }\n          onsuccess.call(xhr, evt, res)\n        }\n      } else {\n        onerror && onerror.call(xhr, evt)\n      }\n    }\n  }\n  xhr.send(data)\n  return xhr\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/request.js\n **/","/*\n  ----------------------------------------------------------\n  GeneralMIDI\n  ----------------------------------------------------------\n*/\n\nimport root from './root'\n\nroot.GM = (function (map) {\n  const clean = function (name) {\n    return name.replace(/[^a-z0-9 ]/gi, '').replace(/[ ]/g, '_').toLowerCase()\n  }\n  const res = {\n    byName: { },\n    byId: { },\n    byCategory: { }\n  }\n  for (let key in map) {\n    var list = map[key]\n    for (var n = 0, length = list.length; n < length; n++) {\n      var instrument = list[n]\n      if (!instrument) continue\n      var num = parseInt(instrument.substr(0, instrument.indexOf(' ')), 10)\n      instrument = instrument.replace(num + ' ', '')\n      res.byId[--num] =\n        res.byName[clean(instrument)] =\n          res.byCategory[clean(key)] = {\n            id: clean(instrument),\n            instrument: instrument,\n            number: num,\n            category: key\n          }\n    }\n  }\n  return res\n})({\n  'Piano': ['1 Acoustic Grand Piano', '2 Bright Acoustic Piano', '3 Electric Grand Piano', '4 Honky-tonk Piano', '5 Electric Piano 1', '6 Electric Piano 2', '7 Harpsichord', '8 Clavinet'],\n  'Chromatic Percussion': ['9 Celesta', '10 Glockenspiel', '11 Music Box', '12 Vibraphone', '13 Marimba', '14 Xylophone', '15 Tubular Bells', '16 Dulcimer'],\n  'Organ': ['17 Drawbar Organ', '18 Percussive Organ', '19 Rock Organ', '20 Church Organ', '21 Reed Organ', '22 Accordion', '23 Harmonica', '24 Tango Accordion'],\n  'Guitar': ['25 Acoustic Guitar (nylon)', '26 Acoustic Guitar (steel)', '27 Electric Guitar (jazz)', '28 Electric Guitar (clean)', '29 Electric Guitar (muted)', '30 Overdriven Guitar', '31 Distortion Guitar', '32 Guitar Harmonics'],\n  'Bass': ['33 Acoustic Bass', '34 Electric Bass (finger)', '35 Electric Bass (pick)', '36 Fretless Bass', '37 Slap Bass 1', '38 Slap Bass 2', '39 Synth Bass 1', '40 Synth Bass 2'],\n  'Strings': ['41 Violin', '42 Viola', '43 Cello', '44 Contrabass', '45 Tremolo Strings', '46 Pizzicato Strings', '47 Orchestral Harp', '48 Timpani'],\n  'Ensemble': ['49 String Ensemble 1', '50 String Ensemble 2', '51 Synth Strings 1', '52 Synth Strings 2', '53 Choir Aahs', '54 Voice Oohs', '55 Synth Choir', '56 Orchestra Hit'],\n  'Brass': ['57 Trumpet', '58 Trombone', '59 Tuba', '60 Muted Trumpet', '61 French Horn', '62 Brass Section', '63 Synth Brass 1', '64 Synth Brass 2'],\n  'Reed': ['65 Soprano Sax', '66 Alto Sax', '67 Tenor Sax', '68 Baritone Sax', '69 Oboe', '70 English Horn', '71 Bassoon', '72 Clarinet'],\n  'Pipe': ['73 Piccolo', '74 Flute', '75 Recorder', '76 Pan Flute', '77 Blown Bottle', '78 Shakuhachi', '79 Whistle', '80 Ocarina'],\n  'Synth Lead': ['81 Lead 1 (square)', '82 Lead 2 (sawtooth)', '83 Lead 3 (calliope)', '84 Lead 4 (chiff)', '85 Lead 5 (charang)', '86 Lead 6 (voice)', '87 Lead 7 (fifths)', '88 Lead 8 (bass + lead)'],\n  'Synth Pad': ['89 Pad 1 (new age)', '90 Pad 2 (warm)', '91 Pad 3 (polysynth)', '92 Pad 4 (choir)', '93 Pad 5 (bowed)', '94 Pad 6 (metallic)', '95 Pad 7 (halo)', '96 Pad 8 (sweep)'],\n  'Synth Effects': ['97 FX 1 (rain)', '98 FX 2 (soundtrack)', '99 FX 3 (crystal)', '100 FX 4 (atmosphere)', '101 FX 5 (brightness)', '102 FX 6 (goblins)', '103 FX 7 (echoes)', '104 FX 8 (sci-fi)'],\n  'Ethnic': ['105 Sitar', '106 Banjo', '107 Shamisen', '108 Koto', '109 Kalimba', '110 Bagpipe', '111 Fiddle', '112 Shanai'],\n  'Percussive': ['113 Tinkle Bell', '114 Agogo', '115 Steel Drums', '116 Woodblock', '117 Taiko Drum', '118 Melodic Tom', '119 Synth Drum'],\n  'Sound effects': ['120 Reverse Cymbal', '121 Guitar Fret Noise', '122 Breath Noise', '123 Seashore', '124 Bird Tweet', '125 Telephone Ring', '126 Helicopter', '127 Applause', '128 Gunshot']\n})\n\n/* get/setInstrument\n--------------------------------------------------- */\nroot.getInstrument = function (channelId) {\n  var channel = root.channels[channelId]\n  return channel && channel.instrument\n}\n\nroot.setInstrument = function (channelId, program, delay) {\n  var channel = root.channels[channelId]\n  if (delay) {\n    return setTimeout(function () {\n      channel.instrument = program\n    }, delay)\n  } else {\n    channel.instrument = program\n  }\n}\n\n/* get/setMono\n--------------------------------------------------- */\nroot.getMono = function (channelId) {\n  var channel = root.channels[channelId]\n  return channel && channel.mono\n}\n\nroot.setMono = function (channelId, truthy, delay) {\n  var channel = root.channels[channelId]\n  if (delay) {\n    return setTimeout(function () {\n      channel.mono = truthy\n    }, delay)\n  } else {\n    channel.mono = truthy\n  }\n}\n\n/* get/setOmni\n--------------------------------------------------- */\nroot.getOmni = function (channelId) {\n  var channel = root.channels[channelId]\n  return channel && channel.omni\n}\n\nroot.setOmni = function (channelId, truthy, delay) {\n  var channel = root.channels[channelId]\n  if (delay) {\n    return setTimeout(function () {\n      channel.omni = truthy\n    }, delay)\n  } else {\n    channel.omni = truthy\n  }\n}\n\n/* get/setSolo\n--------------------------------------------------- */\nroot.getSolo = function (channelId) {\n  var channel = root.channels[channelId]\n  return channel && channel.solo\n}\n\nroot.setSolo = function (channelId, truthy, delay) {\n  var channel = root.channels[channelId]\n  if (delay) {\n    return setTimeout(function () {\n      channel.solo = truthy\n    }, delay)\n  } else {\n    channel.solo = truthy\n  }\n}\n\n/* channels\n--------------------------------------------------- */\nroot.channels = (function () { // 0 - 15 channels\n  var channels = {}\n  for (let i = 0; i < 16; i++) {\n    channels[i] = { // default values\n      instrument: i,\n      pitchBend: 0,\n      mute: false,\n      mono: false,\n      omni: false,\n      solo: false\n    }\n  }\n  return channels\n})()\n\n/* note conversions\n--------------------------------------------------- */\nroot.keyToNote = {} // C8  == 108\nroot.noteToKey = {} // 108 ==  C8\n\n~(function () {\n  var A0 = 0x15 // first note\n  var C8 = 0x6C // last note\n  var number2key = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B']\n  for (let n = A0; n <= C8; n++) {\n    var octave = (n - 12) / 12 >> 0\n    var name = number2key[n % 12] + octave\n    root.keyToNote[name] = n\n    root.noteToKey[n] = name\n  }\n})()\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/gm.js\n **/","/*\n  ----------------------------------------------------------\n  midi.Player : 0.3.1 : 2015-03-26\n  ----------------------------------------------------------\n  https://github.com/mudcube/midi.js\n  ----------------------------------------------------------\n*/\n\nimport { MidiFile, Replayer } from './jasmid'\nimport root from './root'\n\n(function () {\n  root.Player = {}\n  const player = root.Player\n  player.currentTime = 0\n  player.endTime = 0\n  player.restart = 0\n  player.playing = false\n  player.timeWarp = 1\n  player.startDelay = 0\n  player.BPM = 120\n\n  player.start = player.resume = function (onsuccess) {\n    if (player.currentTime < -1) {\n      player.currentTime = -1\n    }\n    startAudio(player.currentTime, null, onsuccess)\n  }\n\n  player.pause = function () {\n    var tmp = player.restart\n    stopAudio()\n    player.restart = tmp\n  }\n\n  player.stop = function () {\n    stopAudio()\n    player.restart = 0\n    player.currentTime = 0\n  }\n\n  player.addListener = function (onsuccess) {\n    onMidiEvent = onsuccess\n  }\n\n  player.removeListener = function () {\n    onMidiEvent = undefined\n  }\n\n  player.clearAnimation = function () {\n    if (player.animationFrameId) {\n      window.cancelAnimationFrame(player.animationFrameId)\n    }\n  }\n\n  player.setAnimation = function (callback) {\n    var currentTime = 0\n    var tOurTime = 0\n    var tTheirTime = 0\n    //\n    player.clearAnimation()\n    // /\n    var frame = function () {\n      player.animationFrameId = window.requestAnimationFrame(frame)\n      // /\n      if (player.endTime === 0) {\n        return\n      }\n      if (player.playing) {\n        currentTime = (tTheirTime === player.currentTime) ? tOurTime - Date.now() : 0\n        if (player.currentTime === 0) {\n          currentTime = 0\n        } else {\n          currentTime = player.currentTime - currentTime\n        }\n        if (tTheirTime !== player.currentTime) {\n          tOurTime = Date.now()\n          tTheirTime = player.currentTime\n        }\n      } else { // paused\n        currentTime = player.currentTime\n      }\n      // /\n      var endTime = player.endTime\n      // var percent = currentTime / endTime\n      var total = currentTime / 1000\n      var minutes = total / 60\n      var seconds = total - (minutes * 60)\n      var t1 = minutes * 60 + seconds\n      var t2 = (endTime / 1000)\n      // /\n      if (t2 - t1 < -1.0) {\n        return\n      } else {\n        callback({\n          now: t1,\n          end: t2,\n          events: noteRegistrar\n        })\n      }\n    }\n    // /\n    window.requestAnimationFrame(frame)\n  }\n\n  // helpers\n\n  player.loadMidiFile = function (onsuccess, onprogress, onerror) {\n    try {\n      // console.log(MidiFile(player.currentData), new Replayer(MidiFile(player.currentData), player.timeWarp, null, player.BPM))\n      player.replayer = new Replayer(MidiFile(player.currentData), player.timeWarp, null, player.BPM)\n      player.data = player.replayer.getData()\n      player.endTime = getLength()\n      // /\n      root.loadPlugin({\n        // instruments: player.getFileInstruments(),\n        onsuccess: onsuccess,\n        onprogress: onprogress,\n        onerror: onerror\n      })\n    } catch (event) {\n      console.error(event)\n      onerror && onerror(event)\n    }\n  }\n\n  player.loadFile = function (file, onsuccess, onprogress, onerror) {\n    player.stop()\n    if (file.indexOf('base64,') !== -1) {\n      var data = window.atob(file.split(',')[1])\n      player.currentData = data\n      player.loadMidiFile(onsuccess, onprogress, onerror)\n    } else {\n      var fetch = new window.XMLHttpRequest()\n      fetch.open('GET', file)\n      fetch.overrideMimeType('text/plain; charset=x-user-defined')\n      fetch.onreadystatechange = function () {\n        if (this.readyState === 4) {\n          if (this.status === 200) {\n            var t = this.responseText || ''\n            var ff = []\n            var mx = t.length\n            var scc = String.fromCharCode\n            for (var z = 0; z < mx; z++) {\n              ff[z] = scc(t.charCodeAt(z) & 255)\n            }\n            // /\n            var data = ff.join('')\n            player.currentData = data\n            player.loadMidiFile(onsuccess, onprogress, onerror)\n          } else {\n            onerror && onerror('Unable to load MIDI file')\n          }\n        }\n      }\n      fetch.send()\n    }\n  }\n\n  player.getFileInstruments = function () {\n    var instruments = {}\n    var programs = {}\n    for (var n = 0; n < player.data.length; n++) {\n      var event = player.data[n][0].event\n      if (event.type !== 'channel') {\n        continue\n      }\n      var channel = event.channel\n      switch (event.subtype) {\n        case 'controller':\n          //        console.log(event.channel, root.defineControl[event.controllerType], event.value)\n          break\n        case 'programChange':\n          programs[channel] = event.programNumber\n          break\n        case 'noteOn':\n          var program = programs[channel]\n          var gm = root.GM.byId[isFinite(program) ? program : channel]\n          instruments[gm.id] = true\n          break\n      }\n    }\n    var ret = []\n    for (var key in instruments) {\n      ret.push(key)\n    }\n    return ret\n  }\n\n  // Playing the audio\n\n  var eventQueue = [] // hold events to be triggered\n  var queuedTime //\n  var startTime = 0 // to measure time elapse\n  var noteRegistrar = {} // get event for requested note\n  var onMidiEvent // listener\n  var scheduleTracking = function (channel, note, currentTime, offset, message, velocity, time) {\n    return setTimeout(function () {\n      var data = {\n        channel: channel,\n        note: note,\n        now: currentTime,\n        end: player.endTime,\n        message: message,\n        velocity: velocity\n      }\n      //\n      if (message === 128) {\n        delete noteRegistrar[note]\n      } else {\n        noteRegistrar[note] = data\n      }\n      if (onMidiEvent) {\n        onMidiEvent(data)\n      }\n      player.currentTime = currentTime\n      // /\n      eventQueue.shift()\n      // /\n      if (eventQueue.length < 1000) {\n        startAudio(queuedTime, true)\n      } else if (player.currentTime === queuedTime && queuedTime < player.endTime) { // grab next sequence\n        startAudio(queuedTime, true)\n      }\n    }, currentTime - offset)\n  }\n\n  var getContext = function () {\n    if (root.api === 'webaudio') {\n      return root.WebAudio.getContext()\n    } else {\n      player.ctx = {currentTime: 0}\n    }\n    return player.ctx\n  }\n\n  var getLength = function () {\n    var data = player.data\n    var length = data.length\n    var totalTime = 0.5\n    for (var n = 0; n < length; n++) {\n      totalTime += data[n][1]\n    }\n    return totalTime\n  }\n\n  var __now\n  var getNow = function () {\n    if (window.performance && window.performance.now) {\n      return window.performance.now()\n    } else {\n      return Date.now()\n    }\n  }\n\n  var startAudio = function (currentTime, fromCache, onsuccess) {\n    if (!player.replayer) {\n      return\n    }\n    if (!fromCache) {\n      if (typeof currentTime === 'undefined') {\n        currentTime = player.restart\n      }\n      // /\n      player.playing && stopAudio()\n      player.playing = true\n      player.data = player.replayer.getData()\n      player.endTime = getLength()\n    }\n    // /\n    var note\n    var offset = 0\n    var messages = 0\n    var data = player.data\n    var ctx = getContext()\n    var length = data.length\n    //\n    queuedTime = 0.5\n    // /\n    // var interval = eventQueue[0] && eventQueue[0].interval || 0\n    var foffset = currentTime - player.currentTime\n    // /\n    if (root.api !== 'webaudio') { // set currentTime on ctx\n      var now = getNow()\n      __now = __now || now\n      ctx.currentTime = (now - __now) / 1000\n    }\n    // /\n    startTime = ctx.currentTime\n    // /\n    for (var n = 0; n < length && messages < 100; n++) {\n      var obj = data[n]\n      if ((queuedTime += obj[1]) <= currentTime) {\n        offset = queuedTime\n        continue\n      }\n      // /\n      currentTime = queuedTime - offset\n      // /\n      var event = obj[0].event\n      if (event.type !== 'channel') {\n        continue\n      }\n      // /\n      var channelId = event.channel\n      var channel = root.channels[channelId]\n      var delay = ctx.currentTime + ((currentTime + foffset + player.startDelay) / 1000)\n      var queueTime = queuedTime - offset + player.startDelay\n      switch (event.subtype) {\n        case 'controller':\n          root.setController(channelId, event.controllerType, event.value, delay)\n          break\n        case 'programChange':\n          root.programChange(channelId, event.programNumber, delay)\n          break\n        case 'pitchBend':\n          root.pitchBend(channelId, event.value, delay)\n          break\n        case 'noteOn':\n          if (channel.mute) break\n          note = event.noteNumber - (player.MIDIOffset || 0)\n          eventQueue.push({\n            event: event,\n            time: queueTime,\n            source: root.noteOn(channelId, event.noteNumber, event.velocity, delay),\n            interval: scheduleTracking(channelId, note, queuedTime + player.startDelay, offset - foffset, 144, event.velocity)\n          })\n          messages++\n          break\n        case 'noteOff':\n          if (channel.mute) break\n          note = event.noteNumber - (player.MIDIOffset || 0)\n          eventQueue.push({\n            event: event,\n            time: queueTime,\n            source: root.noteOff(channelId, event.noteNumber, delay),\n            interval: scheduleTracking(channelId, note, queuedTime, offset - foffset, 128, 0)\n          })\n          break\n        default:\n          break\n      }\n    }\n    // /\n    onsuccess && onsuccess(eventQueue)\n  }\n\n  var stopAudio = function () {\n    var ctx = getContext()\n    player.playing = false\n    player.restart += (ctx.currentTime - startTime) * 1000\n    // stop the audio, and intervals\n    while (eventQueue.length) {\n      let o = eventQueue.pop()\n      window.clearInterval(o.interval)\n      if (!o.source) continue // is not webaudio\n      if (typeof (o.source) === 'number') {\n        window.clearTimeout(o.source)\n      } else { // webaudio\n        o.source.disconnect(0)\n      }\n    }\n    // run callback to cancel any notes still playing\n    for (var key in noteRegistrar) {\n      let o = noteRegistrar[key]\n      if (noteRegistrar[key].message === 144 && onMidiEvent) {\n        onMidiEvent({\n          channel: o.channel,\n          note: o.note,\n          now: o.now,\n          end: o.end,\n          message: 128,\n          velocity: o.velocity\n        })\n      }\n    }\n    // reset noteRegistrar\n    noteRegistrar = {}\n  }\n})()\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/player.js\n **/","export * from './midifile'\nexport * from './replayer'\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/jasmid/index.js\n **/","/**\n * class to parse the .mid file format\n * (depends on _stream.js)\n */\n\nimport Stream from './_stream'\n\nexport function MidiFile (data) {\n  var lastEventTypeByte\n\n  function readChunk (stream) {\n    var id = stream.read(4)\n    var length = stream.readInt32()\n    return {\n      'id': id,\n      'length': length,\n      'data': stream.read(length)\n    }\n  }\n\n  function readEvent (stream) {\n    var event = {}\n    event.deltaTime = stream.readVarInt()\n    var eventTypeByte = stream.readInt8()\n    if ((eventTypeByte & 0xf0) === 0xf0) {\n      /* system / meta event */\n      if (eventTypeByte === 0xff) {\n        /* meta event */\n        event.type = 'meta'\n        var subtypeByte = stream.readInt8()\n        let length = stream.readVarInt()\n        switch (subtypeByte) {\n          case 0x00:\n            event.subtype = 'sequenceNumber'\n            if (length !== 2) throw new Error('Expected length for sequenceNumber event is 2, got ' + length)\n            event.number = stream.readInt16()\n            return event\n          case 0x01:\n            event.subtype = 'text'\n            event.text = stream.read(length)\n            return event\n          case 0x02:\n            event.subtype = 'copyrightNotice'\n            event.text = stream.read(length)\n            return event\n          case 0x03:\n            event.subtype = 'trackName'\n            event.text = stream.read(length)\n            return event\n          case 0x04:\n            event.subtype = 'instrumentName'\n            event.text = stream.read(length)\n            return event\n          case 0x05:\n            event.subtype = 'lyrics'\n            event.text = stream.read(length)\n            return event\n          case 0x06:\n            event.subtype = 'marker'\n            event.text = stream.read(length)\n            return event\n          case 0x07:\n            event.subtype = 'cuePoint'\n            event.text = stream.read(length)\n            return event\n          case 0x20:\n            event.subtype = 'midiChannelPrefix'\n            if (length !== 1) throw new Error('Expected length for midiChannelPrefix event is 1, got ' + length)\n            event.channel = stream.readInt8()\n            return event\n          case 0x2f:\n            event.subtype = 'endOfTrack'\n            if (length !== 0) throw new Error('Expected length for endOfTrack event is 0, got ' + length)\n            return event\n          case 0x51:\n            event.subtype = 'setTempo'\n            if (length !== 3) throw new Error('Expected length for setTempo event is 3, got ' + length)\n            event.microsecondsPerBeat = (\n              (stream.readInt8() << 16) +\n              (stream.readInt8() << 8) +\n              stream.readInt8()\n            )\n            return event\n          case 0x54:\n            event.subtype = 'smpteOffset'\n            if (length !== 5) throw new Error('Expected length for smpteOffset event is 5, got ' + length)\n            var hourByte = stream.readInt8()\n            event.frameRate = {\n              0x00: 24, 0x20: 25, 0x40: 29, 0x60: 30\n            }[hourByte & 0x60]\n            event.hour = hourByte & 0x1f\n            event.min = stream.readInt8()\n            event.sec = stream.readInt8()\n            event.frame = stream.readInt8()\n            event.subframe = stream.readInt8()\n            return event\n          case 0x58:\n            event.subtype = 'timeSignature'\n            if (length !== 4) throw new Error('Expected length for timeSignature event is 4, got ' + length)\n            event.numerator = stream.readInt8()\n            event.denominator = Math.pow(2, stream.readInt8())\n            event.metronome = stream.readInt8()\n            event.thirtyseconds = stream.readInt8()\n            return event\n          case 0x59:\n            event.subtype = 'keySignature'\n            if (length !== 2) throw new Error('Expected length for keySignature event is 2, got ' + length)\n            event.key = stream.readInt8(true)\n            event.scale = stream.readInt8()\n            return event\n          case 0x7f:\n            event.subtype = 'sequencerSpecific'\n            event.data = stream.read(length)\n            return event\n          default:\n            // console.log(\"Unrecognised meta event subtype: \" + subtypeByte)\n            event.subtype = 'unknown'\n            event.data = stream.read(length)\n            return event\n        }\n        // event.data = stream.read(length)\n        // return event\n      } else if (eventTypeByte === 0xf0) {\n        event.type = 'sysEx'\n        let length = stream.readVarInt()\n        event.data = stream.read(length)\n        return event\n      } else if (eventTypeByte === 0xf7) {\n        event.type = 'dividedSysEx'\n        let length = stream.readVarInt()\n        event.data = stream.read(length)\n        return event\n      } else {\n        throw new Error('Unrecognised MIDI event type byte: ' + eventTypeByte)\n      }\n    } else {\n      /* channel event */\n      var param1\n      if ((eventTypeByte & 0x80) === 0) {\n        /* running status - reuse lastEventTypeByte as the event type.\n          eventTypeByte is actually the first parameter\n        */\n        param1 = eventTypeByte\n        eventTypeByte = lastEventTypeByte\n      } else {\n        param1 = stream.readInt8()\n        lastEventTypeByte = eventTypeByte\n      }\n      var eventType = eventTypeByte >> 4\n      event.channel = eventTypeByte & 0x0f\n      event.type = 'channel'\n      switch (eventType) {\n        case 0x08:\n          event.subtype = 'noteOff'\n          event.noteNumber = param1\n          event.velocity = stream.readInt8()\n          return event\n        case 0x09:\n          event.noteNumber = param1\n          event.velocity = stream.readInt8()\n          if (event.velocity === 0) {\n            event.subtype = 'noteOff'\n          } else {\n            event.subtype = 'noteOn'\n          }\n          return event\n        case 0x0a:\n          event.subtype = 'noteAftertouch'\n          event.noteNumber = param1\n          event.amount = stream.readInt8()\n          return event\n        case 0x0b:\n          event.subtype = 'controller'\n          event.controllerType = param1\n          event.value = stream.readInt8()\n          return event\n        case 0x0c:\n          event.subtype = 'programChange'\n          event.programNumber = param1\n          return event\n        case 0x0d:\n          event.subtype = 'channelAftertouch'\n          event.amount = param1\n          return event\n        case 0x0e:\n          event.subtype = 'pitchBend'\n          event.value = param1 + (stream.readInt8() << 7)\n          return event\n        default:\n          throw new Error('Unrecognised MIDI event type: ' + eventType)\n      /*\n      console.log(\"Unrecognised MIDI event type: \" + eventType)\n      stream.readInt8()\n      event.subtype = 'unknown'\n      return event\n      */\n      }\n    }\n  }\n\n  const stream = Stream(data)\n  var headerChunk = readChunk(stream)\n  if (headerChunk.id !== 'MThd' || headerChunk.length !== 6) {\n    throw new Error('Bad .mid file - header not found')\n  }\n  var headerStream = Stream(headerChunk.data)\n  var formatType = headerStream.readInt16()\n  var trackCount = headerStream.readInt16()\n  var timeDivision = headerStream.readInt16()\n  var ticksPerBeat\n\n  if (timeDivision & 0x8000) {\n    throw new Error('Expressing time division in SMTPE frames is not supported yet')\n  } else {\n    ticksPerBeat = timeDivision\n  }\n\n  var header = {\n    'formatType': formatType,\n    'trackCount': trackCount,\n    'ticksPerBeat': ticksPerBeat\n  }\n  var tracks = []\n  for (var i = 0; i < header.trackCount; i++) {\n    tracks[i] = []\n    var trackChunk = readChunk(stream)\n    if (trackChunk.id !== 'MTrk') {\n      throw new Error('Unexpected chunk - expected MTrk, got ' + trackChunk.id)\n    }\n    var trackStream = Stream(trackChunk.data)\n    while (!trackStream.eof()) {\n      var event = readEvent(trackStream)\n      tracks[i].push(event)\n    // console.log(event)\n    }\n  }\n\n  return {\n    'header': header,\n    'tracks': tracks\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/jasmid/midifile.js\n **/","/* Wrapper for accessing strings through sequential reads */\nexport default function (str) {\n  var position = 0\n\n  function read (length) {\n    var result = str.substr(position, length)\n    position += length\n    return result\n  }\n\n  /* read a big-endian 32-bit integer */\n  function readInt32 () {\n    var result = (\n    (str.charCodeAt(position) << 24) +\n    (str.charCodeAt(position + 1) << 16) +\n    (str.charCodeAt(position + 2) << 8) +\n    str.charCodeAt(position + 3))\n    position += 4\n    return result\n  }\n\n  /* read a big-endian 16-bit integer */\n  function readInt16 () {\n    var result = (\n    (str.charCodeAt(position) << 8) +\n    str.charCodeAt(position + 1))\n    position += 2\n    return result\n  }\n\n  /* read an 8-bit integer */\n  function readInt8 (signed) {\n    var result = str.charCodeAt(position)\n    if (signed && result > 127) result -= 256\n    position += 1\n    return result\n  }\n\n  function eof () {\n    return position >= str.length\n  }\n\n  /* read a MIDI-style variable-length integer\n    (big-endian value in groups of 7 bits,\n    with top bit set to signify that another byte follows)\n  */\n  function readVarInt () {\n    var result = 0\n    while (true) {\n      var b = readInt8()\n      if (b & 0x80) {\n        result += (b & 0x7f)\n        result <<= 7\n      } else {\n        /* b is the last byte */\n        return result + b\n      }\n    }\n  }\n\n  return {\n    'eof': eof,\n    'read': read,\n    'readInt32': readInt32,\n    'readInt16': readInt16,\n    'readInt8': readInt8,\n    'readVarInt': readVarInt\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/jasmid/_stream.js\n **/","const clone = function (o) {\n  if (typeof o !== 'object') return (o)\n  if (o === null) return (o)\n  var ret = (typeof o.length === 'number') ? [] : {}\n  for (var key in o) ret[key] = clone(o[key])\n  return ret\n}\n\nexport function Replayer (midiFile, timeWarp, eventProcessor, bpm) {\n  var trackStates = []\n  var beatsPerMinute = bpm || 120\n  var bpmOverride = !!bpm\n  var ticksPerBeat = midiFile.header.ticksPerBeat\n\n  for (let i = 0; i < midiFile.tracks.length; i++) {\n    trackStates[i] = {\n      'nextEventIndex': 0,\n      'ticksToNextEvent': (midiFile.tracks[i].length ? midiFile.tracks[i][0].deltaTime : null)\n    }\n  }\n\n  function getNextEvent () {\n    var ticksToNextEvent = null\n    var nextEventTrack = null\n    var nextEventIndex = null\n\n    for (let i = 0; i < trackStates.length; i++) {\n      if (\n        trackStates[i].ticksToNextEvent != null &&\n        (ticksToNextEvent == null || trackStates[i].ticksToNextEvent < ticksToNextEvent)\n      ) {\n        ticksToNextEvent = trackStates[i].ticksToNextEvent\n        nextEventTrack = i\n        nextEventIndex = trackStates[i].nextEventIndex\n      }\n    }\n    if (nextEventTrack != null) {\n      /* consume event from that track */\n      var nextEvent = midiFile.tracks[nextEventTrack][nextEventIndex]\n      if (midiFile.tracks[nextEventTrack][nextEventIndex + 1]) {\n        trackStates[nextEventTrack].ticksToNextEvent += midiFile.tracks[nextEventTrack][nextEventIndex + 1].deltaTime\n      } else {\n        trackStates[nextEventTrack].ticksToNextEvent = null\n      }\n      trackStates[nextEventTrack].nextEventIndex += 1\n      /* advance timings on all tracks by ticksToNextEvent */\n      for (let i = 0; i < trackStates.length; i++) {\n        if (trackStates[i].ticksToNextEvent != null) {\n          trackStates[i].ticksToNextEvent -= ticksToNextEvent\n        }\n      }\n      return {\n        'ticksToEvent': ticksToNextEvent,\n        'event': nextEvent,\n        'track': nextEventTrack\n      }\n    } else {\n      return null\n    }\n  }\n  //\n  var midiEvent\n  var temporal = []\n  ~(function processEvents () {\n    function processNext () {\n      if (!bpmOverride && midiEvent.event.type === 'meta' && midiEvent.event.subtype === 'setTempo') {\n        // tempo change events can occur anywhere in the middle and affect events that follow\n        beatsPerMinute = 60000000 / midiEvent.event.microsecondsPerBeat\n      }\n      // /\n      var beatsToGenerate = 0\n      var secondsToGenerate = 0\n      if (midiEvent.ticksToEvent > 0) {\n        beatsToGenerate = midiEvent.ticksToEvent / ticksPerBeat\n        secondsToGenerate = beatsToGenerate / (beatsPerMinute / 60)\n      }\n      // /\n      var time = (secondsToGenerate * 1000 * timeWarp) || 0\n      temporal.push([midiEvent, time])\n      midiEvent = getNextEvent()\n    }\n    // /\n    midiEvent = getNextEvent()\n    if (midiEvent) {\n      while (midiEvent) processNext(true)\n    }\n  })()\n\n  return {\n    getData: function () {\n      return clone(temporal)\n    }\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/jasmid/replayer.js\n **/","import './audiotag'\nimport './webaudio'\nimport './webmidi'\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/plugins/index.js\n **/","/*\n  ----------------------------------------------------------------------\n  AudioTag <audio> - OGG or MPEG Soundbank\n  ----------------------------------------------------------------------\n  http://dev.w3.org/html5/spec/Overview.html#the-audio-element\n  ----------------------------------------------------------------------\n*/\nimport root from '../root'\n\nwindow.Audio && (function () {\n  var midi = root.AudioTag = { api: 'audiotag' }\n  var noteToKey = {}\n  var volume = 127 // floating point\n  var bufferNid = -1 // current channel\n  var audioBuffers = [] // the audio channels\n  var notesOn = [] // instrumentId + noteId that is currently playing in each 'channel', for routing noteOff/chordOff calls\n  var notes = {} // the piano keys\n  for (let nid = 0; nid < 12; nid++) {\n    audioBuffers[nid] = new window.Audio()\n  }\n\n  var playChannel = function (channel, note) {\n    if (!root.channels[channel]) return\n    var instrument = root.channels[channel].instrument\n    var instrumentId = root.GM.byId[instrument].id\n    note = notes[note]\n    if (note) {\n      var instrumentNoteId = instrumentId + '' + note.id\n      var nid = (bufferNid + 1) % audioBuffers.length\n      var audio = audioBuffers[nid]\n      notesOn[ nid ] = instrumentNoteId\n      if (!root.Soundfont[instrumentId]) {\n        if (root.DEBUG) {\n          console.log('404', instrumentId)\n        }\n        return\n      }\n      audio.src = root.Soundfont[instrumentId][note.id]\n      audio.volume = volume / 127\n      audio.play()\n      bufferNid = nid\n    }\n  }\n\n  var stopChannel = function (channel, note) {\n    if (!root.channels[channel]) return\n    var instrument = root.channels[channel].instrument\n    var instrumentId = root.GM.byId[instrument].id\n    note = notes[note]\n    if (note) {\n      var instrumentNoteId = instrumentId + '' + note.id\n      for (var i = 0, len = audioBuffers.length; i < len; i++) {\n        var nid = (i + bufferNid + 1) % len\n        var cId = notesOn[nid]\n        if (cId && cId === instrumentNoteId) {\n          audioBuffers[nid].pause()\n          notesOn[nid] = null\n          return\n        }\n      }\n    }\n  }\n\n  midi.audioBuffers = audioBuffers\n  midi.send = function (data, delay) {}\n  midi.setController = function (channel, type, value, delay) {}\n  midi.setVolume = function (channel, n) {\n    volume = n // - should be channel specific volume\n  }\n\n  midi.programChange = function (channel, program) {\n    root.channels[channel].instrument = program\n  }\n\n  midi.pitchBend = function (channel, program, delay) {}\n\n  midi.noteOn = function (channel, note, velocity, delay) {\n    var id = noteToKey[note]\n    if (!notes[id]) return\n    if (delay) {\n      return setTimeout(function () {\n        playChannel(channel, id)\n      }, delay * 1000)\n    } else {\n      playChannel(channel, id)\n    }\n  }\n\n  midi.noteOff = function (channel, note, delay) {\n    //      var id = noteToKey[note]\n    //      if (!notes[id]) return\n    //      if (delay) {\n    //        return setTimeout(function() {\n    //          stopChannel(channel, id)\n    //        }, delay * 1000)\n    //      } else {\n    //        stopChannel(channel, id)\n    //      }\n  }\n\n  midi.chordOn = function (channel, chord, velocity, delay) {\n    for (var idx = 0; idx < chord.length; idx++) {\n      var n = chord[idx]\n      var id = noteToKey[n]\n      if (!notes[id]) continue\n      if (delay) {\n        return setTimeout(function () {\n          playChannel(channel, id)\n        }, delay * 1000)\n      } else {\n        playChannel(channel, id)\n      }\n    }\n  }\n\n  midi.chordOff = function (channel, chord, delay) {\n    for (var idx = 0; idx < chord.length; idx++) {\n      var n = chord[idx]\n      var id = noteToKey[n]\n      if (!notes[id]) continue\n      if (delay) {\n        return setTimeout(function () {\n          stopChannel(channel, id)\n        }, delay * 1000)\n      } else {\n        stopChannel(channel, id)\n      }\n    }\n  }\n\n  midi.stopAllNotes = function () {\n    for (var nid = 0, length = audioBuffers.length; nid < length; nid++) {\n      audioBuffers[nid].pause()\n    }\n  }\n\n  midi.connect = function (opts) {\n    root.setDefaultPlugin(midi)\n    // /\n    for (var key in root.keyToNote) {\n      noteToKey[root.keyToNote[key]] = key\n      notes[key] = {id: key}\n    }\n    // /\n    opts.onsuccess && opts.onsuccess()\n  }\n})()\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/plugins/audiotag.js\n **/","/*\n  ----------------------------------------------------------\n  Web Audio API - OGG or MPEG Soundbank\n  ----------------------------------------------------------\n  http://webaudio.github.io/web-audio-api/\n  ----------------------------------------------------------\n*/\nimport root from '../root'\n\n// REF: http://stackoverflow.com/questions/21797299/convert-base64-string-to-arraybuffer\nfunction base64ToArrayBuffer (base64) {\n  var binaryString = window.atob(base64)\n  var len = binaryString.length\n  var bytes = new Uint8Array(len)\n  for (var i = 0; i < len; i++) {\n    bytes[i] = binaryString.charCodeAt(i)\n  }\n  return bytes.buffer\n}\n\nwindow.AudioContext && (function () {\n  // var audioContext = null // new AudioContext()\n  var useStreamingBuffer = false // !!audioContext.createMediaElementSource\n  var midi = root.WebAudio = { api: 'webaudio' }\n  var ctx // audio context\n  var sources = {}\n  var effects = {}\n  var masterVolume = 127\n  var audioBuffers = {}\n  // /\n  midi.audioBuffers = audioBuffers\n  midi.send = function (data, delay) {}\n  midi.setController = function (channelId, type, value, delay) {}\n\n  midi.setVolume = function (channelId, volume, delay) {\n    if (delay) {\n      setTimeout(function () {\n        masterVolume = volume\n      }, delay * 1000)\n    } else {\n      masterVolume = volume\n    }\n  }\n\n  midi.programChange = function (channelId, program, delay) {\n    //      if (delay) {\n    //        return setTimeout(function() {\n    //          var channel = root.channels[channelId]\n    //          channel.instrument = program\n    //        }, delay)\n    //      } else {\n    var channel = root.channels[channelId]\n    channel.instrument = program\n  //      }\n  }\n\n  midi.pitchBend = function (channelId, program, delay) {\n    //      if (delay) {\n    //        setTimeout(function() {\n    //          var channel = root.channels[channelId]\n    //          channel.pitchBend = program\n    //        }, delay)\n    //      } else {\n    var channel = root.channels[channelId]\n    channel.pitchBend = program\n  //      }\n  }\n\n  midi.noteOn = function (channelId, noteId, velocity, delay) {\n    delay = delay || 0\n\n    // / check whether the note exists\n    var channel = root.channels[channelId]\n    var instrument = channel.instrument\n    var bufferId = instrument + '' + noteId\n    var buffer = audioBuffers[bufferId]\n    if (!buffer) {\n      //        console.log(midi.GM.byId[instrument].id, instrument, channelId)\n      return\n    }\n\n    // / convert relative delay to absolute delay\n    if (delay < ctx.currentTime) {\n      delay += ctx.currentTime\n    }\n\n    // / create audio buffer\n    var source\n    if (useStreamingBuffer) {\n      source = ctx.createMediaElementSource(buffer)\n    } else { // XMLHTTP buffer\n      source = ctx.createBufferSource()\n      source.buffer = buffer\n    }\n\n    // / add effects to buffer\n    if (effects) {\n      var chain = source\n      for (var key in effects) {\n        chain.connect(effects[key].input)\n        chain = effects[key]\n      }\n    }\n\n    // / add gain + pitchShift\n    var gain = (velocity / 127) * (masterVolume / 127) * 2 - 1\n    source.connect(ctx.destination)\n    source.playbackRate.value = 1 // pitch shift\n    source.gainNode = ctx.createGain() // gain\n    source.gainNode.connect(ctx.destination)\n    source.gainNode.gain.value = Math.min(1.0, Math.max(-1.0, gain))\n    source.connect(source.gainNode)\n    // /\n    if (useStreamingBuffer) {\n      if (delay) {\n        return setTimeout(function () {\n          buffer.currentTime = 0\n          buffer.play()\n        }, delay * 1000)\n      } else {\n        buffer.currentTime = 0\n        buffer.play()\n      }\n    } else {\n      source.start(delay || 0)\n    }\n    // /\n    sources[channelId + '' + noteId] = source\n    // /\n    return source\n  }\n\n  midi.noteOff = function (channelId, noteId, delay) {\n    delay = delay || 0\n\n    // / check whether the note exists\n    var channel = root.channels[channelId]\n    var instrument = channel.instrument\n    var bufferId = instrument + '' + noteId\n    var buffer = audioBuffers[bufferId]\n    if (buffer) {\n      if (delay < ctx.currentTime) {\n        delay += ctx.currentTime\n      }\n      // /\n      var source = sources[channelId + '' + noteId]\n      if (source) {\n        if (source.gainNode) {\n          // @Miranet: 'the values of 0.2 and 0.3 could of course be used as\n          // a 'release' parameter for ADSR like time settings.'\n          // add { 'metadata': { release: 0.3 } } to soundfont files\n          var gain = source.gainNode.gain\n          gain.linearRampToValueAtTime(gain.value, delay)\n          gain.linearRampToValueAtTime(-1.0, delay + 0.3)\n        }\n        // /\n        if (useStreamingBuffer) {\n          if (delay) {\n            setTimeout(function () {\n              buffer.pause()\n            }, delay * 1000)\n          } else {\n            buffer.pause()\n          }\n        } else {\n          if (source.noteOff) {\n            source.noteOff(delay + 0.5)\n          } else {\n            source.stop(delay + 0.5)\n          }\n        }\n        // /\n        delete sources[channelId + '' + noteId]\n        // /\n        return source\n      }\n    }\n  }\n\n  midi.chordOn = function (channel, chord, velocity, delay) {\n    var res = {}\n    for (var n = 0, note, len = chord.length; n < len; n++) {\n      res[note = chord[n]] = midi.noteOn(channel, note, velocity, delay)\n    }\n    return res\n  }\n\n  midi.chordOff = function (channel, chord, delay) {\n    var res = {}\n    for (var n = 0, note, len = chord.length; n < len; n++) {\n      res[note = chord[n]] = midi.noteOff(channel, note, delay)\n    }\n    return res\n  }\n\n  midi.stopAllNotes = function () {\n    for (var sid in sources) {\n      var delay = 0\n      if (delay < ctx.currentTime) {\n        delay += ctx.currentTime\n      }\n      var source = sources[sid]\n      source.gain.linearRampToValueAtTime(1, delay)\n      source.gain.linearRampToValueAtTime(0, delay + 0.3)\n      if (source.noteOff) { // old api\n        source.noteOff(delay + 0.3)\n      } else { // new api\n        source.stop(delay + 0.3)\n      }\n      delete sources[sid]\n    }\n  }\n\n  midi.setEffects = function (list) {\n    if (ctx.tunajs) {\n      for (var n = 0; n < list.length; n++) {\n        var data = list[n]\n        var effect = new ctx.tunajs[data.type](data)\n        effect.connect(ctx.destination)\n        effects[data.type] = effect\n      }\n    } else {\n      return console.log('Effects module not installed.')\n    }\n  }\n\n  midi.connect = function (opts) {\n    root.setDefaultPlugin(midi)\n    midi.setContext(ctx || createAudioContext(), opts.onsuccess)\n  }\n\n  midi.getContext = function () {\n    return ctx\n  }\n\n  midi.setContext = function (newCtx, onload, onprogress, onerror) {\n    ctx = newCtx\n\n    // / tuna.js effects module - https://github.com/Dinahmoe/tuna\n    if (typeof window.Tuna !== 'undefined' && !ctx.tunajs) {\n      ctx.tunajs = new window.Tuna(ctx)\n    }\n\n    // / loading audio files\n    var urls = []\n    var notes = root.keyToNote\n    for (let key in notes) urls.push(key)\n    // /\n    var waitForEnd = function (instrument) {\n      for (let key in bufferPending) { // has pending items\n        if (bufferPending[key]) return\n      }\n      // /\n      if (onload) { // run onload once\n        onload()\n        onload = null\n      }\n    }\n    // /\n    var requestAudio = function (soundfont, instrumentId, index, key) {\n      var url = soundfont[key]\n      if (url) {\n        bufferPending[instrumentId]++\n        loadAudio(url, function (buffer) {\n          buffer.id = key\n          var noteId = root.keyToNote[key]\n          audioBuffers[instrumentId + '' + noteId] = buffer\n          // /\n          if (--bufferPending[instrumentId] === 0) {\n            // var percent = index / 87\n            //              console.log(midi.GM.byId[instrumentId], 'processing: ', percent)\n            soundfont.isLoaded = true\n            waitForEnd(instrument)\n          }\n        }, function (err) {\n          console.error(err)\n        })\n      }\n    }\n    // /\n    var bufferPending = {}\n    for (var instrument in root.Soundfont) {\n      var soundfont = root.Soundfont[instrument]\n      if (soundfont.isLoaded) {\n        continue\n      }\n      // /\n      var synth = root.GM.byName[instrument]\n      var instrumentId = synth.number\n      // /\n      bufferPending[instrumentId] = 0\n      // /\n      for (let index = 0; index < urls.length; index++) {\n        let key = urls[index]\n        requestAudio(soundfont, instrumentId, index, key)\n      }\n    }\n    // /\n    setTimeout(waitForEnd, 1)\n  }\n\n  /* Load audio file: streaming | base64 | arraybuffer\n  ---------------------------------------------------------------------- */\n  function loadAudio (url, onload, onerror) {\n    if (useStreamingBuffer) {\n      var audio = new window.Audio()\n      audio.src = url\n      audio.controls = false\n      audio.autoplay = false\n      audio.preload = false\n      audio.addEventListener('canplay', function () {\n        onload && onload(audio)\n      })\n      audio.addEventListener('error', function (err) {\n        onerror && onerror(err)\n      })\n      document.body.appendChild(audio)\n    } else if (url.indexOf('data:audio') === 0) { // Base64 string\n      var base64 = url.split(',')[1]\n      var buffer = base64ToArrayBuffer(base64)\n      ctx.decodeAudioData(buffer, onload, onerror)\n    } else { // XMLHTTP buffer\n      var request = new window.XMLHttpRequest()\n      request.open('GET', url, true)\n      request.responseType = 'arraybuffer'\n      request.onload = function () {\n        ctx.decodeAudioData(request.response, onload, onerror)\n      }\n      request.send()\n    }\n  }\n\n  function createAudioContext () {\n    return new (window.AudioContext || window.webkitAudioContext)()\n  }\n})()\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/plugins/webaudio.js\n **/","/*\n  ----------------------------------------------------------------------\n  Web MIDI API - Native Soundbanks\n  ----------------------------------------------------------------------\n  http://webaudio.github.io/web-midi-api/\n  ----------------------------------------------------------------------\n*/\nimport root from '../root'\n\n(function () {\n  var plugin = null\n  var output = null\n  var midi = root.WebMIDI = {api: 'webmidi'}\n  midi.send = function (data, delay) { // set channel volume\n    output.send(data, delay * 1000)\n  }\n\n  midi.setController = function (channel, type, value, delay) {\n    output.send([channel, type, value], delay * 1000)\n  }\n\n  midi.setVolume = function (channel, volume, delay) { // set channel volume\n    output.send([0xB0 + channel, 0x07, volume], delay * 1000)\n  }\n\n  midi.programChange = function (channel, program, delay) { // change patch (instrument)\n    output.send([0xC0 + channel, program], delay * 1000)\n  }\n\n  midi.pitchBend = function (channel, program, delay) { // pitch bend\n    output.send([0xE0 + channel, program], delay * 1000)\n  }\n\n  midi.noteOn = function (channel, note, velocity, delay) {\n    output.send([0x90 + channel, note, velocity], delay * 1000)\n  }\n\n  midi.noteOff = function (channel, note, delay) {\n    output.send([0x80 + channel, note, 0], delay * 1000)\n  }\n\n  midi.chordOn = function (channel, chord, velocity, delay) {\n    for (var n = 0; n < chord.length; n++) {\n      var note = chord[n]\n      output.send([0x90 + channel, note, velocity], delay * 1000)\n    }\n  }\n\n  midi.chordOff = function (channel, chord, delay) {\n    for (var n = 0; n < chord.length; n++) {\n      var note = chord[n]\n      output.send([0x80 + channel, note, 0], delay * 1000)\n    }\n  }\n\n  midi.stopAllNotes = function () {\n    output.cancel()\n    for (var channel = 0; channel < 16; channel++) {\n      output.send([0xB0 + channel, 0x7B, 0])\n    }\n  }\n\n  midi.connect = function (opts) {\n    root.setDefaultPlugin(midi)\n    var errFunction = function (err) { // well at least we tried!\n      if (window.AudioContext) { // Chrome\n        opts.api = 'webaudio'\n      } else if (window.Audio) { // Firefox\n        opts.api = 'audiotag'\n      } else { // no support\n        return err\n      }\n      root.loadPlugin(opts)\n    }\n    // /\n    navigator.requestMIDIAccess().then(function (access) {\n      plugin = access\n      var pluginOutputs = plugin.outputs\n      if (typeof pluginOutputs === 'function') { // Chrome pre-43\n        output = pluginOutputs()[0]\n      } else { // Chrome post-43\n        output = pluginOutputs[0]\n      }\n      if (output === undefined) { // nothing there...\n        errFunction()\n      } else {\n        opts.onsuccess && opts.onsuccess()\n      }\n    }, errFunction)\n  }\n})()\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/plugins/webmidi.js\n **/"],"sourceRoot":""}